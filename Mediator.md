## Паттерн Mediator / "Посредник"

Авторы: Калегин Евгений, Вахрушев Михаил

---

**Посредник** - поведенческий паттерн. Паттерн связывает объекты в системе и позволяет им общаться через него.
Посредник похож на паттерн фасад, но в отличие от фасада, он так же способен передавать информацию между компонентами, которые в других ситуациях взаимодействовали бы напрямую.
## Проблема
С ростом системы, добавлением сложного функционала и правил работы, компоненты усложняются и работать с ними становится тяжелее. Добавление новых объектов, которые используют функции уже имеющихся может требовать изменения старых объектов, что усложняет разработку.
Посредник позволяет централизировать функционал.

Использование паттерна позволяет ослабить связанность и избавить объекты от необходимости явно ссылать на друг друга.

Работа программы без посредника и с ним:

![Диаграмма работы программы без посредника и с ним](https://sbcode.net/python/img/mediator_concept.svg)

Структура работы посредника:

![Диаграмма работы посредника](https://sbcode.net/python/img/mediator_example.svg)

## Пример кода

```python
from abc import ABCMeta, abstractmethod
class IMediator(metaclass=ABCMeta):
    "Интерфейс посредника, указывающий все методы, которые нужно реализовать"
    @staticmethod
    @abstractmethod
    def colleague1_method():
        "Метод который нкжно реализовать"
    @staticmethod
    @abstractmethod
    def colleague2_method():
        "Метод который нкжно реализовать"
class Mediator(IMediator):
    "Сам класс посредника"
    def __init__(self):
        self.colleague1 = Colleague1()
        self.colleague2 = Colleague2()
    def colleague1_method(self):
        return self.colleague1.colleague1_method()
    def colleague2_method(self):
        return self.colleague2.colleague2_method()
class Colleague1(IMediator):
    "Этот коллега (1) вызывает другого коллегу (2) через посредника"
    def colleague1_method(self):
        return "Вот та конкретная информация Коллеги1, которую вы запрашивали"
    def colleague2_method(self):
        "не реализовано"
class Colleague2(IMediator):
    "Этот коллега (2) вызывает другого коллегу (1) через посредника"
    def colleague1_method(self):
        "не реализовано"
    def colleague2_method(self):
        return "Вот та конкретная информация Коллеги2, которую вы запрашивали"
# Этот клиент либо Коллега1, либо Коллега2
# Этот коллега будет использовать посредника, а не вызывать другого коллегу напрямую.
MEDIATOR = Mediator()
# Если я Коллега1, мне нужна информация от Коллеги2
DATA = MEDIATOR.colleague2_method()
print(f"COLLEAGUE1 <--> {DATA}")
# Если я Коллега2, мне нужна информация от Коллеги1
DATA = MEDIATOR.colleague1_method()
print(f"COLLEAGUE2 <--> {DATA}")
```
Вывод программы:
```
python ./mediator/mediator_concept.py    
COLLEAGUE1 <--> Вот та конкретная информация Коллеги2, которую вы запрашивали
COLLEAGUE2 <--> Вот та конкретная информация Коллеги1, которую вы запрашивали
```
## Итого
* Посредник заменяет структуру с взаимодействием "многие-ко-многим" между ее классами и процессами на централизованную структуру "один-ко-многим", где интерфейс поддерживает все методы структуры "многие-ко-многим", но через компонент посредника.
* Паттерн "посредник" создаёт возможность использования общих объектов, которыми можно централизованно управлять и синхронизировать.
* Паттерн "посредник" создает абстракцию между двумя или более компонентами, что облегчает понимание и управление системой.

